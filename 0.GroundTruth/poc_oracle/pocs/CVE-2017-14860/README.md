# Heap Buffer Overflow in Exiv2::Jp2Image::readMetadata

## POC URL
No direct URL provided, but the issue is documented in Red Hat Bugzilla [Bug 1494776](https://bugzilla.redhat.com/show_bug.cgi?id=1494776) and upstream at [Exiv2 GitHub Issue #71](https://github.com/Exiv2/exiv2/issues/71).

## Compilation Environment
- **OS**: Linux x86_64
- **Exiv2 Version**: 0.26 (64-bit build)
- **ASAN**: Enabled (AddressSanitizer)

## Run Command
```
exiv2 003-heap-buffer-over.jp2
```

## Expected Output
```
=================================================================
==34506==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61200000be69 at pc 0x7fa4854c3935 bp 0x7ffdf8967ef0 sp 0x7ffdf8967698
READ of size 808464432 at 0x61200000be69 thread T0
    #0 0x7fa4854c3934 in __asan_memcpy (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x8c934)
    #1 0x7fa484d5f07c in Exiv2::Jp2Image::readMetadata() /root/fuzzing/exiv2-trunk/src/jp2image.cpp:277
    #2 0x43ab02 in Action::Print::printSummary() /root/fuzzing/exiv2-trunk/src/actions.cpp:289
    #3 0x43a1af in Action::Print::run(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /root/fuzzing/exiv2-trunk/src/actions.cpp:244
    #4 0x422129 in main /root/fuzzing/exiv2-trunk/src/exiv2.cpp:170
    #5 0x7fa4840a382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)
    #6 0x421af8 in _start (/usr/local/exiv2_ASAN/bin/exiv2+0x421af8)

0x61200000be69 is located 0 bytes to the right of 297-byte region [0x61200000bd40,0x61200000be69)
allocated by thread T0 here:
    #0 0x7fa4854d06b2 in operator new[](unsigned long) (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x996b2)
    #1 0x454805 in Exiv2::DataBuf::DataBuf(long) /root/fuzzing/exiv2-trunk/include/exiv2/types.hpp:204
    #2 0x7fa484d5ef9a in Exiv2::Jp2Image::readMetadata() /root/fuzzing/exiv2-trunk/src/jp2image.cpp:273
    #3 0x43ab02 in Action::Print::printSummary() /root/fuzzing/exiv2-trunk/src/actions.cpp:289
    #4 0x43a1af in Action::Print::run(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /root/fuzzing/exiv2-trunk/src/actions.cpp:244
    #5 0x422129 in main /root/fuzzing/exiv2-trunk/src/exiv2.cpp:170
    #6 0x7fa4840a382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)

SUMMARY: AddressSanitizer: heap-buffer-overflow ??:0 __asan_memcpy
==34506==ABORTING
```

This output shows a heap buffer overflow occurring in `Exiv2::Jp2Image::readMetadata()` at line 277 of `jp2image.cpp`. The issue was assigned CVE-2017-14860 and fixed in Exiv2 version 0.27.0.