# HDF5 Vulnerability Proof-of-Concept

## POC URL
https://github.com/TeamSeri0us/pocs/blob/master/hdf5/poc

## Compilation Environment
- Operating System: Linux
- Required Tools: gcc or clang
- Dependencies: HDF5 library

## Run Command
```
./h5dump-shared $file
```

## Expected Output
==80179==AddressSanitizer: libc interceptors initialized
|| `[0x10007fff8000, 0x7fffffffffff]` || HighMem    ||
|| `[0x02008fff7000, 0x10007fff7fff]` || HighShadow ||
|| `[0x00008fff7000, 0x02008fff6fff]` || ShadowGap  ||
|| `[0x00007fff8000, 0x00008fff6fff]` || LowShadow  ||
|| `[0x000000000000, 0x00007fff7fff]` || LowMem     ||
MemToShadow(shadow): 0x00008fff7000 0x000091ff6dff 0x004091ff6e00 0x02008fff6fff
redzone=16
max_redzone=2048
quarantine_size_mb=256M
thread_local_quarantine_size_kb=1024K
malloc_context_size=30
SHADOW_SCALE: 3
SHADOW_GRANULARITY: 8
SHADOW_OFFSET: 0x7fff8000
==80179==Installed the sigaction for signal 11
==80179==Installed the sigaction for signal 7
==80179==Installed the sigaction for signal 8
==80179==T0: stack [0x7ffeda666000,0x7ffedae66000) size 0x800000; local=0x7ffedae62fe8
==80179==AddressSanitizer Init done
=================================================================
==80179==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffedae60c86 at pc 0x7fe3e6f4653d bp 0x7ffedae60b30 sp 0x7ffedae60b28
READ of size 1 at 0x7ffedae60c86 thread T0
    #0 0x7fe3e6f4653c in H5F_addr_decode_len /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Fint.c:1752:6
    #1 0x7fe3e6f4653c in H5F_addr_decode /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Fint.c:1807
    #2 0x7fe3e7018671 in H5G_ent_decode /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Gent.c:161:13
    #3 0x7fe3e6f6c885 in H5F_sblock_load /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Fsuper_cache.c:291:12
    #4 0x7fe3e7762728 in H5C_load_entry /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5C.c:7950:25
    #5 0x7fe3e7762728 in H5C_protect /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5C.c:3568
    #6 0x7fe3e6dfa8ad in H5AC_protect /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5AC.c:1250:13
    #7 0x7fe3e6f62e56 in H5F_super_read /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Fsuper.c:291:41
    #8 0x7fe3e6f40466 in H5F_open /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Fint.c:1084:12
    #9 0x7fe3e6f2ab74 in H5Fopen /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5F.c:601:28
    #10 0x7fe3e7c8df79 in h5tools_fopen /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/tools/lib/h5tools.c:567:23
    #11 0x5196c8 in main /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/tools/h5dump/h5dump.c:1429:15
    #12 0x7fe3e5c6eb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
    #13 0x41dfa9 in _start (/home/pwd/fuzz/fuzz-hdf5/pwd-build/installed/bin/h5dump-shared+0x41dfa9)

Address 0x7ffedae60c86 is located in stack of thread T0 at offset 166 in frame
    #0 0x7fe3e6f68e4f in H5F_sblock_load /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Fsuper_cache.c:112

  This frame has 13 object(s):
    [32, 166) 'sbuf' (line 115) <== Memory access at offset 166 overflows this variable
    [240, 248) 'stored_eoa' (line 120)
    [272, 273) 'sizeof_addr' (line 122)
    [288, 289) 'sizeof_size' (line 123)
    [304, 312) 'p' (line 126)
    [336, 340) 'super_vers' (line 127)
    [352, 360) 'btree_k' (line 196)
    [384, 388) 'sym_leaf_k' (line 197)
    [400, 1424) 'dbuf' (line 335)
    [1552, 1561) 'drv_name' (line 336)
    [1584, 1608) 'ext_loc' (line 486)
    [1648, 1660) 'btreek' (line 487)
    [1680, 1712) 'drvinfo' (line 488)
HINT: this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext
      (longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow /home/pwd/fuzz/fuzz-hdf5/hdf5-1.8.20/src/H5Fint.c:1752:6 in H5F_addr_decode_len
Shadow bytes around the buggy address:
  0x10005b5c4140: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10005b5c4150: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10005b5c4160: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10005b5c4170: 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1
  0x10005b5c4180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x10005b5c4190:[06]f2 f2 f2 f2 f2 f2 f2 f2 f2 00 f2 f2 f2 01 f2
  0x10005b5c41a0: 01 f2 00 f2 f2 f2 04 f2 00 f2 f2 f2 04 f2 f8 f8
  0x10005b5c41b0: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8
  0x10005b5c41c0: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8
  0x10005b5c41d0: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8
  0x10005b5c41e0: f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==80179==ABORTING