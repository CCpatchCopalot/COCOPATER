# Null Dereference in MP4Box gf_odf_desc_copy

## POC URL
https://github.com/gpac/gpac/issues/3089

## Compilation Environment
- GPAC version: Latest from GitHub (as of April 2021)
- Operating System: Linux/Windows
- Compiler: gcc/Visual Studio

## Run Command
```
https://github.com/gpac/gpac/issues/3089
```

## Expected Output
$ ./bin/gcc/MP4Box -dash 1000 -out /dev/null ./fuzzer01 
[iso file] Unknown box type 00000000 in parent moov
[iso file] Unknown box type dref in parent moov
[iso file] Unknown box type stbl in parent moov
[iso file] Box "sgpd" size 44 (start 1416) invalid (read 51)
[iso file] extra box udta found in moov, deleting
=================================================================
==3627136==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020000123d8 at pc 0x7ffff784992a bp 0x7fffffff2620 sp 0x7fffffff1dc8
READ of size 4294967290 at 0x6020000123d8 thread T0
    #0 0x7ffff7849929 in __interceptor_memcpy ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:827
    #1 0x7ffff5019492 in memcpy /usr/include/x86_64-linux-gnu/bits/string_fortified.h:29
    #2 0x7ffff5019492 in gf_props_assign_value filter_core/filter_props.c:1157
    #3 0x7ffff5019492 in gf_props_insert_property filter_core/filter_props.c:1241
    #4 0x7ffff5019bf6 in gf_props_set_property filter_core/filter_props.c:1264
    #5 0x7ffff4fc9f08 in gf_filter_pid_set_property_full filter_core/filter_pid.c:5891
    #6 0x7ffff4fc9f08 in gf_filter_pid_set_property filter_core/filter_pid.c:5898
    #7 0x7ffff5319afe in isor_declare_track filters/isoffin_load.c:1252
    #8 0x7ffff533387a in isor_declare_objects filters/isoffin_load.c:1770
    #9 0x7ffff5335205 in isoffin_setup filters/isoffin_read.c:181
    #10 0x7ffff533ee75 in isoffin_configure_pid filters/isoffin_read.c:507
    #11 0x7ffff4ff21f5 in gf_filter_pid_configure filter_core/filter_pid.c:916
    #12 0x7ffff4ffb6c2 in gf_filter_pid_connect_task filter_core/filter_pid.c:1295
    #13 0x7ffff5042b43 in gf_fs_thread_proc filter_core/filter_session.c:2171
    #14 0x7ffff50479d8 in gf_fs_run filter_core/filter_session.c:2478
    #15 0x7ffff4999092 in gf_dasher_process media_tools/dash_segmenter.c:1273
    #16 0x55555559195c in do_dash /home/ps/fuzzingwork/FuzzingGPAC/gpac/applications/mp4box/mp4box.c:4850
    #17 0x555555583158 in mp4box_main /home/ps/fuzzingwork/FuzzingGPAC/gpac/applications/mp4box/mp4box.c:6295
    #18 0x7ffff1e29d8f in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
    #19 0x7ffff1e29e3f in __libc_start_main_impl ../csu/libc-start.c:392
    #20 0x55555556ad14 in _start (/home/ps/fuzzingwork/FuzzingGPAC/gpac/bin/gcc/MP4Box+0x16d14)

0x6020000123d8 is located 6 bytes to the right of 2-byte region [0x6020000123d0,0x6020000123d2)
allocated by thread T0 here:
    #0 0x7ffff78bf91f in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:69
    #1 0x7ffff49269fb in gf_odf_read_default odf/odf_code.c:1285
    #2 0x7ffff490f07d in gf_odf_read_descriptor_internal odf/desc_private.c:366
    #3 0x7ffff490f07d in gf_odf_read_descriptor odf/desc_private.c:378
    #4 0x7ffff490fa16 in gf_odf_parse_descriptor odf/descriptors.c:109
    #5 0x7ffff4925c92 in gf_odf_read_dcd odf/odf_code.c:1149
    #6 0x7ffff490f0dd in gf_odf_read_descriptor_internal odf/desc_private.c:284
    #7 0x7ffff490f0dd in gf_odf_read_descriptor odf/desc_private.c:378
    #8 0x7ffff490fa16 in gf_odf_parse_descriptor odf/descriptors.c:109
    #9 0x7ffff491dd5d in gf_odf_read_esd odf/odf_code.c:274
    #10 0x7ffff490f0c5 in gf_odf_read_descriptor_internal odf/desc_private.c:282
    #11 0x7ffff490f0c5 in gf_odf_read_descriptor odf/desc_private.c:378
    #12 0x7ffff490fa16 in gf_odf_parse_descriptor odf/descriptors.c:109
    #13 0x7ffff492a540 in gf_odf_desc_read odf/odf_codec.c:301
    #14 0x7ffff492aae6 in gf_odf_desc_copy odf/odf_codec.c:389
    #15 0x7ffff483b181 in Media_GetESD isomedia/media.c:453
    #16 0x7ffff48c6542 in GetESD isomedia/track.c:86
    #17 0x7ffff478bbcb in gf_isom_get_esd isomedia/isom_read.c:1377
    #18 0x7ffff4972c7d in gf_media_map_esd media_tools/isom_tools.c:1357
    #19 0x7ffff53154e5 in isor_declare_track filters/isoffin_load.c:190
    #20 0x7ffff533387a in isor_declare_objects filters/isoffin_load.c:1770
    #21 0x7ffff5335205 in isoffin_setup filters/isoffin_read.c:181
    #22 0x7ffff533ee75 in isoffin_configure_pid filters/isoffin_read.c:507
    #23 0x7ffff4ff21f5 in gf_filter_pid_configure filter_core/filter_pid.c:916
    #24 0x7ffff4ffb6c2 in gf_filter_pid_connect_task filter_core/filter_pid.c:1295
    #25 0x7ffff5042b43 in gf_fs_thread_proc filter_core/filter_session.c:2171
    #26 0x7ffff50479d8 in gf_fs_run filter_core/filter_session.c:2478
    #27 0x7ffff4999092 in gf_dasher_process media_tools/dash_segmenter.c:1273
    #28 0x55555559195c in do_dash /home/ps/fuzzingwork/FuzzingGPAC/gpac/applications/mp4box/mp4box.c:4850

SUMMARY: AddressSanitizer: heap-buffer-overflow ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:827 in __interceptor_memcpy
Shadow bytes around the buggy address:
  0x0c047fffa420: fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa 00 00
  0x0c047fffa430: fa fa fd fd fa fa fd fd fa fa fd fa fa fa fd fd
  0x0c047fffa440: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd
  0x0c047fffa450: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd
  0x0c047fffa460: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd
=>0x0c047fffa470: fa fa fd fd fa fa fd fd fa fa 02[fa]fa fa fd fd
  0x0c047fffa480: fa fa 00 00 fa fa 00 00 fa fa 00 00 fa fa fd fa
  0x0c047fffa490: fa fa 00 00 fa fa 00 00 fa fa 03 fa fa fa 00 00
  0x0c047fffa4a0: fa fa fd fa fa fa 04 fa fa fa 00 04 fa fa fd fd
  0x0c047fffa4b0: fa fa fd fd fa fa 01 fa fa fa fa fa fa fa fa fa
  0x0c047fffa4c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==3627136==ABORTING