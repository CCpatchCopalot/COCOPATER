{
    "0": "-    if (!nb_pack) {\n-        nb_pack = 1;\n-    }\n\n+    CHECK_PACK(GF_ISOM_VALID_FILE)\n\n-    CHECK_PACK(GF_ISOM_VALID_FILE)\n\n+    if (!nb_pack) {\n+        nb_pack = 1;\n+    }\n\n-    if (!nb_pack) {\n-        nb_pack = 1;\n-    }\n\n+    CHECK_PACK(GF_ISOM_VALID_FILE)\n\n-    CHECK_PACK(GF_ISOM_VALID_FILE)\n\n+    if (!nb_pack) {\n+        nb_pack = 1;\n+    }\n\n",
    "1": "-GF_Err stbl_AddSize(GF_SampleSizeBox *stsz, u32 sampleNumber, u32 size, u32 nb_pack_samples) {\n\n+GF_Err stbl_AddSize(GF_SampleSizeBox *stsz, u32 sampleNumber, u32 size, u32 nb_pack) {\n\n-    if (!nb_pack_samples) {\n-        nb_pack_samples = 1;\n-    } else if (nb_pack_samples>1) {\n-        size /= nb_pack_samples;\n-    }\n\n+    CHECK_PACK(GF_BAD_PARAM)\n+    if (nb_pack>1)\n+        size /= nb_pack;\n\n-            stsz->sampleCount = nb_pack_samples;\n\n+            stsz->sampleCount = nb_pack;\n\n-            stsz->sampleCount += nb_pack_samples;\n\n+            stsz->sampleCount += nb_pack;\n\n-        if (nb_pack_samples>1) {\n\n+        if (nb_pack>1) {\n\n-GF_Err stbl_AddSize(GF_SampleSizeBox *stsz, u32 sampleNumber, u32 size, u32 nb_pack) {\n\n+GF_Err stbl_AddSize(GF_SampleSizeBox *stsz, u32 sampleNumber, u32 size, u32 nb_pack_samples) {\n\n-    CHECK_PACK(GF_BAD_PARAM)\n-    if (nb_pack>1)\n-        size /= nb_pack;\n\n+    if (!nb_pack_samples) {\n+        nb_pack_samples = 1;\n+    } else if (nb_pack_samples>1) {\n+        size /= nb_pack_samples;\n+    }\n\n-            stsz->sampleCount = nb_pack;\n\n+            stsz->sampleCount = nb_pack_samples;\n\n-            stsz->sampleCount += nb_pack;\n\n+            stsz->sampleCount += nb_pack_samples;\n\n-        if (nb_pack>1) {\n\n+        if (nb_pack_samples>1) {\n\n-GF_Err stbl_AddDTS(GF_SampleTableBox *stbl, u64 DTS, u32 *sampleNumber, u32 LastAUDefDuration, u32 nb_packed_samples) {\n\n+#define CHECK_PACK(_e) if (!nb_pack) nb_pack = 1; else if ((s32) nb_pack < 0) { GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAER, (\"[iso file] Too many samples %u in packed sample\\n\", nb_pack)); return _e;\n+GF_Err stbl_AddDTS(GF_SampleTableBox *stbl, u64 DTS, u32 *sampleNumber, u32 LastAUDefDuration, u32 nb_pack) {\n\n-    if (!nb_packed_samples) {\n-        nb_packed_samples=1;\n-    }\n\n+    CHECK_PACK(GF_BAD_PARAM)\n\n-        stts->entries[0].sampleCount = nb_packed_samples;\n-        stts->entries[0].sampleDelta = (nb_packed_samples>1) ? 0 : LastAUDefDuration;\n\n+        stts->entries[0].sampleCount = nb_pack;\n+        stts->entries[0].sampleDelta = (nb_pack>1) ? 0 : LastAUDefDuration;\n\n-        stts->w_currentSampleNum = nb_packed_samples;\n\n+        stts->w_currentSampleNum = nb_pack;\n\n-        if ((DTS == stts->w_LastDTS + ent->sampleDelta)\n-                || ((nb_packed_samples>1) && ((DTS == stts->w_LastDTS) || (DTS == stts->w_LastDTS + 2*ent->sampleDelta) ))\n\n+        if ((DTS == stts->w_LastDTS + ent->sampleDelta) || ((nb_pack>1) && ((DTS == stts->w_LastDTS) || (DTS == stts->w_LastDTS + 2*ent->sampleDelta) ))\n\n-            ent->sampleCount += nb_packed_samples;\n-            stts->w_currentSampleNum += nb_packed_samples;\n-            stts->w_LastDTS = DTS + ent->sampleDelta * (nb_packed_samples-1);\n\n+            ent->sampleCount += nb_pack;\n+            stts->w_currentSampleNum += nb_pack;\n+            stts->w_LastDTS = DTS + ent->sampleDelta * (nb_pack-1);\n\n-        if (nb_packed_samples>1) {\n\n+        if (nb_pack>1) {\n\n-        if (nb_packed_samples==1) {\n\n+        if (nb_pack==1) {\n\n-        ent->sampleCount = nb_packed_samples;\n\n+        ent->sampleCount = nb_pack;\n\n-        stts->w_currentSampleNum += nb_packed_samples;\n\n+        stts->w_currentSampleNum += nb_pack;\n\n-    CHECK_PACK(GF_BAD_PARAM)\n\n+    if (!nb_packed_samples) {\n+        nb_packed_samples=1;\n+    }\n\n-        stts->entries[0].sampleCount = nb_pack;\n-        stts->entries[0].sampleDelta = (nb_pack>1) ? 0 : LastAUDefDuration;\n\n+        stts->entries[0].sampleCount = nb_packed_samples;\n+        stts->entries[0].sampleDelta = (nb_packed_samples>1) ? 0 : LastAUDefDuration;\n\n-        stts->w_currentSampleNum = nb_pack;\n\n+        stts->w_currentSampleNum = nb_packed_samples;\n\n-        if ((DTS == stts->w_LastDTS + ent->sampleDelta) || ((nb_pack>1) && ((DTS == stts->w_LastDTS) || (DTS == stts->w_LastDTS + 2*ent->sampleDelta) ))\n\n+        if ((DTS == stts->w_LastDTS + ent->sampleDelta)\n+                || ((nb_packed_samples>1) && ((DTS == stts->w_LastDTS) || (DTS == stts->w_LastDTS + 2*ent->sampleDelta) ))\n\n-            ent->sampleCount += nb_pack;\n-            stts->w_currentSampleNum += nb_pack;\n-            stts->w_LastDTS = DTS + ent->sampleDelta * (nb_pack-1);\n\n+            ent->sampleCount += nb_packed_samples;\n+            stts->w_currentSampleNum += nb_packed_samples;\n+            stts->w_LastDTS = DTS + ent->sampleDelta * (nb_packed_samples-1);\n\n-        if (nb_pack>1) {\n\n+        if (nb_packed_samples>1) {\n\n-        if (nb_pack==1) {\n\n+        if (nb_packed_samples==1) {\n\n-        ent->sampleCount = nb_pack;\n\n+        ent->sampleCount = nb_packed_samples;\n\n-        stts->w_currentSampleNum += nb_pack;\n\n+        stts->w_currentSampleNum += nb_packed_samples;\n\n-GF_Err stbl_AddChunkOffset(GF_MediaBox *mdia, u32 sampleNumber, u32 StreamDescIndex, u64 offset, u32 nb_pack_samples) {\n\n+GF_Err stbl_AddChunkOffset(GF_MediaBox *mdia, u32 sampleNumber, u32 StreamDescIndex, u64 offset, u32 nb_pack) {\n\n-    if (!nb_pack_samples) {\n-        nb_pack_samples = 1;\n-    }\n\n+    CHECK_PACK(GF_BAD_PARAM)\n\n-        stsc->w_lastSampleNumber = sampleNumber + nb_pack_samples-1;\n\n+        stsc->w_lastSampleNumber = sampleNumber + nb_pack-1;\n\n-    ent->samplesPerChunk = nb_pack_samples;\n\n+    ent->samplesPerChunk = nb_pack;\n\n-    if (sampleNumber + nb_pack_samples - 1 == stsc->w_lastSampleNumber) {\n\n+    if (sampleNumber + nb_pack - 1 == stsc->w_lastSampleNumber) {\n\n-GF_Err stbl_AddChunkOffset(GF_MediaBox *mdia, u32 sampleNumber, u32 StreamDescIndex, u64 offset, u32 nb_pack) {\n\n+GF_Err stbl_AddChunkOffset(GF_MediaBox *mdia, u32 sampleNumber, u32 StreamDescIndex, u64 offset, u32 nb_pack_samples) {\n\n-    CHECK_PACK(GF_BAD_PARAM)\n\n+    if (!nb_pack_samples) {\n+        nb_pack_samples = 1;\n+    }\n\n-        stsc->w_lastSampleNumber = sampleNumber + nb_pack-1;\n\n+        stsc->w_lastSampleNumber = sampleNumber + nb_pack_samples-1;\n\n-    ent->samplesPerChunk = nb_pack;\n\n+    ent->samplesPerChunk = nb_pack_samples;\n\n-    if (sampleNumber + nb_pack - 1 == stsc->w_lastSampleNumber) {\n\n+    if (sampleNumber + nb_pack_samples - 1 == stsc->w_lastSampleNumber) {\n\n"
}