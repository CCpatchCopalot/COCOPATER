diff --git a/libr/io/io_bank.c b/libr/io/io_bank.c
index 228e422d65..882dfc48d1 100644
--- a/libr/io/io_bank.c
+++ b/libr/io/io_bank.c
@@ -230,7 +230,10 @@ R_API bool r_io_bank_map_add_top(RIO *io, const ut32 bankid, const ut32 mapid) {
 		//delete all submaps that are completly included in sm
 		RRBNode *next = r_rbnode_next (entry);
 		// this can be optimized, there is no need to do search here
-		r_crbtree_delete (bank->submaps, entry->data, _find_sm_by_from_vaddr_cb, NULL);
+		bool a = r_crbtree_delete (bank->submaps, entry->data, _find_sm_by_from_vaddr_cb, NULL);
+		if (!a) {
+			break;
+		}
 		entry = next;
 	}
 	if (entry && r_io_submap_from (((RIOSubMap *)entry->data)) <= r_io_submap_to (sm)) {
diff --git a/libr/io/io_bank.c b/libr/io/io_bank.c
index 91f3bd1764..dc13c286b6 100644
--- a/libr/io/io_bank.c
+++ b/libr/io/io_bank.c
@@ -227,20 +227,20 @@ R_API bool r_io_bank_map_add_top(RIO *io, const ut32 bankid, const ut32 mapid) {
 		entry = r_rbnode_next (entry);
 	}
 	ut64 smto = r_io_submap_to (sm);
-	while (entry && r_io_submap_to (((RIOSubMap *)entry->data)) <= smto) {
-		//delete all submaps that are completly included in sm
-		RRBNode *next = r_rbnode_next (entry);
-		// this can be optimized, there is no need to do search here
-		// XXX this is a workaround to avoid an UAF in Reproducer: iobank-crash
-		void *smfree = bank->submaps->free;
-		bank->submaps->free = NULL;
-		bool a = r_crbtree_delete (bank->submaps, entry->data, _find_sm_by_from_vaddr_cb, NULL);
-		bank->submaps->free = smfree;
-		if (!a) {
-			entry = NULL;
-			break;
+	if (entry) {
+		ut64 ento = r_io_submap_to (((RIOSubMap*)entry->data));
+		while (entry && ento <= smto) {
+			//delete all submaps that are completly included in sm
+			RRBNode *next = r_rbnode_next (entry);
+			// this can be optimized, there is no need to do search here
+			// XXX this is a workaround to avoid an UAF in Reproducer: iobank-crash
+			ento = r_io_submap_to (((RIOSubMap*)entry->data));
+			bool a = r_crbtree_delete (bank->submaps, entry->data, _find_sm_by_from_vaddr_cb, NULL);
+			if (!a) {
+				next = NULL;
+			}
+			entry = next;
 		}
-		entry = next;
 	}
 	if (entry && r_io_submap_from (((RIOSubMap *)entry->data)) <= r_io_submap_to (sm)) {
 		bd = (RIOSubMap *)entry->data;
