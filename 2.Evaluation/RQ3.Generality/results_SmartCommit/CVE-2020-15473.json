{
    "0": "-    if(packet->payload_packet_len >= 40) {\n\n+    int16_t ovpn_payload_len = packet->payload_packet_len;\n+    if(ovpn_payload_len >= 40) {\n\n-            ovpn_payload += 2;\n\n+            ovpn_payload += 2, ovpn_payload_len -= 2;;\n\n-            if( (flow->num_processed_pkts == 1) && (\n-                        ((packet->payload_packet_len == 112) && ((opcode == 168) || (opcode == 192))\n-                        ) || ((packet->payload_packet_len == 80) && ((opcode == 184) || (opcode == 88) || (opcode == 160) || (opcode == 168) || (opcode == 200)))\n\n+            if( (flow->num_processed_pkts == 1) && ( ((ovpn_payload_len == 112) && ((opcode == 168) || (opcode == 192))\n+                                                     ) || ((ovpn_payload_len == 80) && ((opcode == 184) || (opcode == 88) || (opcode == 160) || (opcode == 168) || (opcode == 200)))\n\n-                alen = ovpn_payload[P_PACKET_ID_ARRAY_LEN_OFFSET(hmac_size)];\n\n+                u_int16_t offset = P_PACKET_ID_ARRAY_LEN_OFFSET(hmac_size);\n+                alen = ovpn_payload[offset];\n\n-                    session_remote = ovpn_payload + P_PACKET_ID_ARRAY_LEN_OFFSET(hmac_size) + 1 + alen * 4;\n\n+                    offset += 1 + alen * 4;\n+                    if((offset+8) <= ovpn_payload_len) {\n+                        session_remote = &ovpn_payload[offset];\n\n-    int16_t ovpn_payload_len = packet->payload_packet_len;\n-    if(ovpn_payload_len >= 40) {\n\n+    if(packet->payload_packet_len >= 40) {\n\n-            ovpn_payload += 2, ovpn_payload_len -= 2;;\n\n+            ovpn_payload += 2;\n\n-            if( (flow->num_processed_pkts == 1) && ( ((ovpn_payload_len == 112) && ((opcode == 168) || (opcode == 192))\n-                                                     ) || ((ovpn_payload_len == 80) && ((opcode == 184) || (opcode == 88) || (opcode == 160) || (opcode == 168) || (opcode == 200)))\n\n+            if( (flow->num_processed_pkts == 1) && (\n+                        ((packet->payload_packet_len == 112) && ((opcode == 168) || (opcode == 192))\n+                        ) || ((packet->payload_packet_len == 80) && ((opcode == 184) || (opcode == 88) || (opcode == 160) || (opcode == 168) || (opcode == 200)))\n\n-                u_int16_t offset = P_PACKET_ID_ARRAY_LEN_OFFSET(hmac_size);\n-                alen = ovpn_payload[offset];\n\n+                alen = ovpn_payload[P_PACKET_ID_ARRAY_LEN_OFFSET(hmac_size)];\n\n-                    offset += 1 + alen * 4;\n-                    if((offset+8) <= ovpn_payload_len) {\n-                        session_remote = &ovpn_payload[offset];\n\n+                    session_remote = ovpn_payload + P_PACKET_ID_ARRAY_LEN_OFFSET(hmac_size) + 1 + alen * 4;\n\n",
    "1": "-                   htons(packet->udp->dest), packet->payload_packet_len);\n\n+                   htons(packet->udp->dest), ovpn_payload_len);\n\n-                   htons(packet->udp->dest), ovpn_payload_len);\n\n+                   htons(packet->udp->dest), packet->payload_packet_len);\n\n",
    "2": "+        } else {\n+            failed = 1;\n+        }\n\n",
    "3": "-        } else {\n-            failed = 1;\n-        }\n\n"
}