{
    "0": "+        if (!attr[1]) {\n+            fr_strerror_printf(\"EAP-Sim attribute %d (no.%d) has no data\", eapsim_attribute, es_attribute_count);\n+            return 0;\n+        }\n\n",
    "1": "-        if(eapsim_len > MAX_STRG_LEN) {\n-            eapsim_len = MAX_STRG_LEN;\n-        }\n-        if (eapsim_len < 2) {\n-            fr_strerror_printf(\"EAP-Sim attribute %d (no.%d) has length too small\", eapsim_attribute, es_attribute_count);\n\n+        newvp = fr_pair_afrom_num(r, eapsim_attribute + PW_EAP_SIM_BASE, 0);\n+        if (!newvp) {\n+            if (eapsim_attribute <= 127) {\n+                fr_strerror_printf(\"Unknown mandatory attribute %d, failing\", eapsim_attribute);\n\n-        newvp = fr_pair_afrom_num(r, eapsim_attribute+PW_EAP_SIM_BASE, 0);\n\n+        } else {\n\n-        newvp = NULL;\n\n+        }\n\n-        if (!attr[1]) {\n-            fr_strerror_printf(\"EAP-Sim attribute %d (no.%d) has no data\", eapsim_attribute, es_attribute_count);\n-            return 0;\n-        }\n\n-        newvp = fr_pair_afrom_num(r, eapsim_attribute + PW_EAP_SIM_BASE, 0);\n-        if (!newvp) {\n-            if (eapsim_attribute <= 127) {\n-                fr_strerror_printf(\"Unknown mandatory attribute %d, failing\", eapsim_attribute);\n\n+        if(eapsim_len > MAX_STRG_LEN) {\n+            eapsim_len = MAX_STRG_LEN;\n+        }\n+        if (eapsim_len < 2) {\n+            fr_strerror_printf(\"EAP-Sim attribute %d (no.%d) has length too small\", eapsim_attribute, es_attribute_count);\n\n-        } else {\n\n+        newvp = fr_pair_afrom_num(r, eapsim_attribute+PW_EAP_SIM_BASE, 0);\n\n-            memcpy(p, &attr[2], newvp->vp_length);\n\n+        memcpy(p, &attr[2], eapsim_len-2);\n\n-        }\n\n+        newvp = NULL;\n\n",
    "2": "-        memcpy(p, &attr[2], eapsim_len-2);\n\n+            memcpy(p, &attr[2], newvp->vp_length);\n\n"
}