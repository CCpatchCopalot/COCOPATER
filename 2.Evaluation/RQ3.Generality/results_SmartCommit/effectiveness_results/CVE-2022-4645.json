{
    "0": "-static uint32_t checkInkNamesString(TIFF* tif, uint32_t slen, const char* s) {\n-    TIFFDirectory* td = &tif->tif_dir;\n-    uint16_t i = td->td_samplesperpixel;\n-    if (slen > 0) {\n\n+static uint16_t countInkNamesString(TIFF *tif, uint32_t slen, const char *s) {\n+    uint16_t i = 0;\n\n-        for (; i > 0; i--) {\n\n+    if (slen > 0) {\n+        do {\n\n-        }\n-        return ((uint32_t)(cp - s));\n\n+            i++;\n+        } while (cp < ep);\n+        return (i);\n\n-static uint16_t countInkNamesString(TIFF *tif, uint32_t slen, const char *s) {\n-    uint16_t i = 0;\n\n+static uint32_t checkInkNamesString(TIFF* tif, uint32_t slen, const char* s) {\n+    TIFFDirectory* td = &tif->tif_dir;\n+    uint16_t i = td->td_samplesperpixel;\n+    if (slen > 0) {\n\n-    if (slen > 0) {\n-        do {\n\n+        for (; i > 0; i--) {\n\n-            i++;\n-        } while (cp < ep);\n-        return (i);\n\n+        }\n+        return ((uint32_t)(cp - s));\n\n",
    "1": "-    TIFFErrorExt(tif->tif_clientdata, \"TIFFSetField\", \"%s: Invalid InkNames value; expecting %\"PRIu16\" names, found %\"PRIu16, tif->tif_name, td->td_samplesperpixel, (uint16_t)(td->td_samplesperpixel-i));\n\n+    TIFFErrorExt(tif->tif_clientdata, \"TIFFSetField\", \"%s: Invalid InkNames value; no NUL at given buffer end location %\"PRIu32\", after %\"PRIu16\" ink\", tif->tif_name, slen, i);\n\n",
    "2": "-    TIFFErrorExt(tif->tif_clientdata, \"TIFFSetField\", \"%s: Invalid InkNames value; no NUL at given buffer end location %\"PRIu32\", after %\"PRIu16\" ink\", tif->tif_name, slen, i);\n\n+    TIFFErrorExt(tif->tif_clientdata, \"TIFFSetField\", \"%s: Invalid InkNames value; expecting %\"PRIu16\" names, found %\"PRIu16, tif->tif_name, td->td_samplesperpixel, (uint16_t)(td->td_samplesperpixel-i));\n\n",
    "3": "-    case TIFFTAG_KNAMES:\n\n+    case TIFFTAG_KNAMES: {\n\n",
    "4": "-        v = checkInkNamesString(tif, v, s);\n-        status = v > 0;\n-        if( v > 0 ) {\n\n+        uint16_t ninksinstring;\n+        ninksinstring = countInkNamesString(tif, v, s);\n+        status = ninksinstring > 0;\n+        if(ninksinstring > 0 ) {\n\n-        uint16_t ninksinstring;\n-        ninksinstring = countInkNamesString(tif, v, s);\n-        status = ninksinstring > 0;\n-        if(ninksinstring > 0 ) {\n\n+        v = checkInkNamesString(tif, v, s);\n+        status = v > 0;\n+        if( v > 0 ) {\n\n-            if (TIFFFieldSet(tif, FIELD_NUMBEROFKS)) {\n-                if (td->td_numberofinks != ninksinstring) {\n-                    TIFFErrorExt(tif->tif_clientdata, module, \"Warning %s; Tag %s:\\n  Value %\"PRIu16\" of NumberOfInks is different from the number of inks %\"PRIu16\".\\n  -> NumberOfInks value adapted to %\"PRIu16\"\",\n-                                 tif->tif_name, fip->field_name, td->td_numberofinks, ninksinstring, ninksinstring);\n-                    td->td_numberofinks = ninksinstring;\n-                }\n-            } else {\n-                td->td_numberofinks = ninksinstring;\n-                TIFFSetFieldBit(tif, FIELD_NUMBEROFKS);\n-            }\n-            if (TIFFFieldSet(tif, FIELD_SAMPLESPERPIXEL)) {\n-                if (td->td_numberofinks != td->td_samplesperpixel) {\n-                    TIFFErrorExt(tif->tif_clientdata, module, \"Warning %s; Tag %s:\\n  Value %\"PRIu16\" of NumberOfInks is different from the SamplesPerPixel value %\"PRIu16\"\", tif->tif_name, fip->field_name,\n-                                 td->td_numberofinks, td->td_samplesperpixel);\n-                }\n-            }\n-        }\n-    }\n-    break;\n-    case TIFFTAG_NUMBEROFKS:\n-        v = (uint16_t)va_arg(ap, uint16_vap);\n-        if (TIFFFieldSet(tif, FIELD_KNAMES)) {\n-            if (v != td->td_numberofinks) {\n-                TIFFErrorExt(tif->tif_clientdata, module,\n-                             \"Error %s; Tag %s:\\n  It is not possible to set the value %\"PRIu32\" for NumberOfInks\\n  which is different from the number of inks in the InkNames tag (%\"PRIu16\")\", tif->tif_name, fip->field_name, v,\n-                             td->td_numberofinks);\n-                status = 0;\n-            }\n-        } else {\n-            td->td_numberofinks = (uint16_t)v;\n-            if (TIFFFieldSet(tif, FIELD_SAMPLESPERPIXEL)) {\n-                if (td->td_numberofinks != td->td_samplesperpixel) {\n-                    TIFFErrorExt(tif->tif_clientdata, module, \"Warning %s; Tag %s:\\n  Value %\"PRIu32\" of NumberOfInks is different from the SamplesPerPixel value %\"PRIu16\"\", tif->tif_name, fip->field_name, v,\n-                                 td->td_samplesperpixel);\n-                }\n-            }\n\n",
    "5": "+            if (TIFFFieldSet(tif, FIELD_NUMBEROFKS)) {\n+                if (td->td_numberofinks != ninksinstring) {\n+                    TIFFErrorExt(tif->tif_clientdata, module, \"Warning %s; Tag %s:\\n  Value %\"PRIu16\" of NumberOfInks is different from the number of inks %\"PRIu16\".\\n  -> NumberOfInks value adapted to %\"PRIu16\"\",\n+                                 tif->tif_name, fip->field_name, td->td_numberofinks, ninksinstring, ninksinstring);\n+                    td->td_numberofinks = ninksinstring;\n+                }\n+            } else {\n+                td->td_numberofinks = ninksinstring;\n+                TIFFSetFieldBit(tif, FIELD_NUMBEROFKS);\n+            }\n+            if (TIFFFieldSet(tif, FIELD_SAMPLESPERPIXEL)) {\n+                if (td->td_numberofinks != td->td_samplesperpixel) {\n+                    TIFFErrorExt(tif->tif_clientdata, module, \"Warning %s; Tag %s:\\n  Value %\"PRIu16\" of NumberOfInks is different from the SamplesPerPixel value %\"PRIu16\"\", tif->tif_name, fip->field_name,\n+                                 td->td_numberofinks, td->td_samplesperpixel);\n+                }\n+            }\n+        }\n+    }\n+    break;\n+    case TIFFTAG_NUMBEROFKS:\n+        v = (uint16_t)va_arg(ap, uint16_vap);\n+        if (TIFFFieldSet(tif, FIELD_KNAMES)) {\n+            if (v != td->td_numberofinks) {\n+                TIFFErrorExt(tif->tif_clientdata, module,\n+                             \"Error %s; Tag %s:\\n  It is not possible to set the value %\"PRIu32\" for NumberOfInks\\n  which is different from the number of inks in the InkNames tag (%\"PRIu16\")\", tif->tif_name, fip->field_name, v,\n+                             td->td_numberofinks);\n+                status = 0;\n+            }\n+        } else {\n+            td->td_numberofinks = (uint16_t)v;\n+            if (TIFFFieldSet(tif, FIELD_SAMPLESPERPIXEL)) {\n+                if (td->td_numberofinks != td->td_samplesperpixel) {\n+                    TIFFErrorExt(tif->tif_clientdata, module, \"Warning %s; Tag %s:\\n  Value %\"PRIu32\" of NumberOfInks is different from the SamplesPerPixel value %\"PRIu16\"\", tif->tif_name, fip->field_name, v,\n+                                 td->td_samplesperpixel);\n+                }\n+            }\n\n",
    "6": "-    case TIFFTAG_KNAMES: {\n\n+    case TIFFTAG_KNAMES:\n\n",
    "7": "+            if (TIFFFieldSet(tif, FIELD_NUMBEROFKS)) {\n+                if (!TIFFWriteDirectoryTagShort(tif, &ndir, dir, TIFFTAG_NUMBEROFKS, tif->tif_dir.td_numberofinks)) {\n+                    goto bad;\n+                }\n+            }\n\n",
    "8": "-            if (TIFFFieldSet(tif, FIELD_NUMBEROFKS)) {\n-                if (!TIFFWriteDirectoryTagShort(tif, &ndir, dir, TIFFTAG_NUMBEROFKS, tif->tif_dir.td_numberofinks)) {\n-                    goto bad;\n-                }\n-            }\n\n",
    "9": "+    if (TIFFFieldSet(tif, FIELD_NUMBEROFKS)) {\n+        fprintf(fd, \"  NumberOfInks: %d\\n\", td->td_numberofinks);\n+    }\n\n",
    "10": "-    if (TIFFFieldSet(tif, FIELD_NUMBEROFKS)) {\n-        fprintf(fd, \"  NumberOfInks: %d\\n\", td->td_numberofinks);\n-    }\n\n",
    "11": "-    if( standard_tag == TIFFTAG_NUMBEROFKS ) {\n-        int i;\n-        for (i = 0; i < td->td_customValueCount; i++) {\n-            uint16_t val;\n-            TIFFTagValue *tv = td->td_customValues + i;\n-            if (tv->info->field_tag != standard_tag) {\n-                continue;\n-            }\n-            if( tv->value == NULL ) {\n-                return 0;\n-            }\n-            val = *(uint16_t *)tv->value;\n-            if( val > td->td_samplesperpixel ) {\n-                TIFFWarningExt(tif->tif_clientdata,\"_TIFFVGetField\", \"Truncating NumberOfInks from %u to %\"PRIu16, val, td->td_samplesperpixel);\n-                val = td->td_samplesperpixel;\n-            }\n-            *va_arg(ap, uint16_t*) = val;\n-            return 1;\n-        }\n-        return 0;\n-    }\n\n",
    "12": "+    case TIFFTAG_NUMBEROFKS:\n+        *va_arg(ap, uint16_t *) = td->td_numberofinks;\n+        break;\n\n",
    "13": "+    if( standard_tag == TIFFTAG_NUMBEROFKS ) {\n+        int i;\n+        for (i = 0; i < td->td_customValueCount; i++) {\n+            uint16_t val;\n+            TIFFTagValue *tv = td->td_customValues + i;\n+            if (tv->info->field_tag != standard_tag) {\n+                continue;\n+            }\n+            if( tv->value == NULL ) {\n+                return 0;\n+            }\n+            val = *(uint16_t *)tv->value;\n+            if( val > td->td_samplesperpixel ) {\n+                TIFFWarningExt(tif->tif_clientdata,\"_TIFFVGetField\", \"Truncating NumberOfInks from %u to %\"PRIu16, val, td->td_samplesperpixel);\n+                val = td->td_samplesperpixel;\n+            }\n+            *va_arg(ap, uint16_t*) = val;\n+            return 1;\n+        }\n+        return 0;\n+    }\n\n",
    "14": "-    case TIFFTAG_NUMBEROFKS:\n-        *va_arg(ap, uint16_t *) = td->td_numberofinks;\n-        break;\n\n"
}